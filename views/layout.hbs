<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{{title}}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/styles.css">
  </head>
  <body>
        {{{body}}}
        <div class="container mt-5">
            <div id="messages" class="row">
                <div class="col-12 d-flex justify-content-start">
                </div>
                <div class="col-12 d-flex justify-content-end">
                </div>
                
            </div>
        </div>
        <div class="w-100 p-absolute bottom-0 pb-3">
            <div style="bottom: 0px;" class="w-100 row justify-content-center">
                <div class="col-10"> <input type="text" id="message-input" class="form-control w-100"></div>
                <div class="col-1"><button class="btn btn-primary" onclick="sendMessage()">send</button></div>
            </div>
        </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let socket = io();
        //socket.on('connect',()=>console.log("Connected in Client"))
        socket.on("ServerEvent",(data)=>{
            
            if (data.data)
                for (var i = 0; i < data.data.length; i++){
                    createMessage(data.data[i])
                }
        })
        function sendMessage(){
            const message = document.getElementById('message-input');
            socket.emit('clientMessage', {
                status: "SUCCESS",
                data:[message.value]
            })
            createMessage(message.value, true)
            message.value = ""
            
        }
        

        function createMessage(text, sender=false){
            if(text){
                const message = document.createElement('div');
                message.innerText = text;
                const messageContainer = document.createElement('div');
                messageContainer.appendChild(message)
                document.getElementById("messages").appendChild(messageContainer)
                if (sender){
                    messageContainer.className = "col-12 d-flex justify-content-end"
                    message.classList.add("message", 'sender', 'message-bottom')
                }else{
                    messageContainer.className = "col-12 d-flex justify-content-start"
                    message.classList.add("message", 'receiver', 'message-bottom')
                }
                setTimeout(function(){
                    message.classList.remove('message-bottom')
                }, 1)
            }
        }
    </script>
  </body>
</html>